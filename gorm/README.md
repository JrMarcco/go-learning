# GORM åˆ†é¡µæœç´¢æŸ¥è¯¢æœ€ä½³å®è·µ

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ GORM åˆ†é¡µæœç´¢æŸ¥è¯¢ç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºäº†å¦‚ä½•æ„å»ºé«˜æ•ˆã€å®‰å…¨ã€å¯ç»´æŠ¤çš„åˆ†é¡µæœç´¢åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„

```
gorm/
â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ user.go      # ç”¨æˆ·æ¨¡å‹å®šä¹‰
â”œâ”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ pagination.go # åˆ†é¡µå’Œæœç´¢ç›¸å…³ç±»å‹
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ validation.go # éªŒè¯å’Œå®‰å…¨å·¥å…·
â”‚   â””â”€â”€ pagination.go # åˆ†é¡µå·¥å…·å‡½æ•°
â”œâ”€â”€ cache/           # ç¼“å­˜å±‚
â”‚   â””â”€â”€ cache.go     # ç¼“å­˜æ¥å£å’Œå®ç°
â”œâ”€â”€ services/        # æœåŠ¡å±‚
â”‚   â””â”€â”€ user_service.go # ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ handlers/        # HTTPå¤„ç†å™¨
â”‚   â””â”€â”€ user_handler.go # ç”¨æˆ·APIå¤„ç†å™¨
â”œâ”€â”€ example/         # ç¤ºä¾‹ç¨‹åº
â”‚   â””â”€â”€ main.go      # å®Œæ•´ç¤ºä¾‹åº”ç”¨
â””â”€â”€ README.md        # é¡¹ç›®æ–‡æ¡£
```

## æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. å®‰å…¨åˆ†é¡µæŸ¥è¯¢
- âœ… SQLæ³¨å…¥é˜²æŠ¤
- âœ… å‚æ•°éªŒè¯å’Œæ¸…ç†
- âœ… å®‰å…¨çš„æ’åºå­—æ®µæ˜ å°„
- âœ… åˆ†é¡µå‚æ•°é™åˆ¶

### 2. å¤šæ ·åŒ–æœç´¢æ”¯æŒ
- âœ… åŸºç¡€åˆ†é¡µæœç´¢
- âœ… æ¨¡ç³Šæœç´¢ï¼ˆå§“åã€é‚®ç®±ã€åŸå¸‚ç­‰ï¼‰
- âœ… ç²¾ç¡®æœç´¢ï¼ˆçŠ¶æ€ã€è§’è‰²ç­‰ï¼‰
- âœ… èŒƒå›´æœç´¢ï¼ˆå¹´é¾„ã€æ—¥æœŸç­‰ï¼‰
- âœ… æ¸¸æ ‡åˆ†é¡µï¼ˆé€‚ç”¨äºå¤§æ•°æ®é‡ï¼‰
- âœ… é«˜çº§æ¡ä»¶æœç´¢

### 3. æ€§èƒ½ä¼˜åŒ–
- âœ… æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- âœ… é¢„åŠ è½½å…³è”æ•°æ®
- âœ… é€‰æ‹©æ€§å­—æ®µæŸ¥è¯¢
- âœ… Redisç¼“å­˜æ”¯æŒ
- âœ… è¿æ¥æ± é…ç½®

### 4. å¼€å‘å‹å¥½
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… ç»“æ„åŒ–å“åº”æ ¼å¼
- âœ… å®Œæ•´çš„APIæ–‡æ¡£æ³¨é‡Š
- âœ… å¯é…ç½®çš„ä¸­é—´ä»¶
- âœ… è¯¦ç»†çš„ç¤ºä¾‹ä»£ç 

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Go 1.24+
- MySQL 8.0+
- Redis 6.0+ (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

### 2. å®‰è£…ä¾èµ–

```bash
cd gorm
go mod tidy
```

### 3. æ•°æ®åº“é…ç½®

åˆ›å»ºMySQLæ•°æ®åº“ï¼š

```sql
CREATE DATABASE gorm_example CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4. è¿è¡Œç¤ºä¾‹

```bash
go run example/main.go
```

### 5. æµ‹è¯•API

è®¿é—® http://localhost:8080/api/v1/examples æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„APIç«¯ç‚¹ç¤ºä¾‹ã€‚

## API ç«¯ç‚¹è¯´æ˜

### åŸºç¡€CRUDæ“ä½œ

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| POST | `/api/v1/users` | åˆ›å»ºç”¨æˆ· |
| GET | `/api/v1/users/:id` | è·å–ç”¨æˆ·è¯¦æƒ… |
| PUT | `/api/v1/users/:id` | æ›´æ–°ç”¨æˆ· |
| DELETE | `/api/v1/users/:id` | åˆ é™¤ç”¨æˆ· |

### æœç´¢å’Œåˆ†é¡µ

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/v1/users/search` | åŸºç¡€æœç´¢ï¼ˆå«å…³è”æ•°æ®ï¼‰ |
| GET | `/api/v1/users/search/simple` | ç®€å•æœç´¢ï¼ˆä»…åŸºæœ¬å­—æ®µï¼‰ |
| GET | `/api/v1/users/search/cursor` | æ¸¸æ ‡åˆ†é¡µæœç´¢ |
| POST | `/api/v1/users/search/advanced` | é«˜çº§æ¡ä»¶æœç´¢ |

### å…¶ä»–åŠŸèƒ½

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/v1/users/stats` | ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ |
| POST | `/api/v1/users/batch` | æ‰¹é‡åˆ›å»ºç”¨æˆ· |
| GET | `/api/v1/users/role/:role_id` | æŒ‰è§’è‰²è·å–ç”¨æˆ· |

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€åˆ†é¡µæœç´¢

```bash
# æœç´¢å§“ååŒ…å«"å¼ "çš„ç”¨æˆ·ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åˆ—
curl "http://localhost:8080/api/v1/users/search?name=å¼ &page=1&page_size=10&order_by=created_at&sort=desc"
```

### 2. å¤åˆæ¡ä»¶æœç´¢

```bash
# æœç´¢æ´»è·ƒçŠ¶æ€ã€å¹´é¾„20-30å²ã€åœ¨åŒ—äº¬çš„ç”¨æˆ·
curl "http://localhost:8080/api/v1/users/search?status=1&min_age=20&max_age=30&city=åŒ—äº¬"
```

### 3. æ¸¸æ ‡åˆ†é¡µ

```bash
# é¦–æ¬¡è¯·æ±‚
curl "http://localhost:8080/api/v1/users/search/cursor?limit=10&direction=next"

# ä¸‹ä¸€é¡µï¼ˆä½¿ç”¨è¿”å›çš„next_cursorï¼‰
curl "http://localhost:8080/api/v1/users/search/cursor?limit=10&direction=next&cursor=eyJpZCI6MTAsImNyZWF0ZWRfYXQiOiIyMDI0LTAxLTE1VDA5OjMwOjAwWiJ9"
```

### 4. é«˜çº§æœç´¢

```bash
curl -X POST "http://localhost:8080/api/v1/users/search/advanced" \
  -H "Content-Type: application/json" \
  -d '{
    "name_like": "å¼ ",
    "status_in": [1, 2],
    "age_range": {"min": 20, "max": 30},
    "created_after": "2024-01-01 00:00:00"
  }'
```

### 5. æ‰¹é‡åˆ›å»ºç”¨æˆ·

```bash
curl -X POST "http://localhost:8080/api/v1/users/batch" \
  -H "Content-Type: application/json" \
  -d '[
    {
      "name": "æµ‹è¯•ç”¨æˆ·1",
      "email": "test1@example.com",
      "phone": "13800138001",
      "status": 1,
      "age": 25,
      "city": "åŒ—äº¬"
    },
    {
      "name": "æµ‹è¯•ç”¨æˆ·2",
      "email": "test2@example.com",
      "phone": "13800138002",
      "status": 1,
      "age": 28,
      "city": "ä¸Šæµ·"
    }
  ]'
```

## å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "data": [...],
    "total": 100,
    "page": 1,
    "page_size": 10,
    "total_pages": 10,
    "has_next": true,
    "has_prev": false
  }
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "invalid query parameters",
  "error": "page size must not exceed 100"
}
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ç´¢å¼•

ç¡®ä¿ä¸ºå¸¸ç”¨çš„æœç´¢å­—æ®µåˆ›å»ºç´¢å¼•ï¼š

```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX idx_users_name ON users(name);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_city ON users(city);
CREATE INDEX idx_users_age ON users(age);
CREATE INDEX idx_users_created_at ON users(created_at);

-- å¤åˆç´¢å¼•ï¼ˆé’ˆå¯¹å¸¸ç”¨çš„æœç´¢ç»„åˆï¼‰
CREATE INDEX idx_users_status_city ON users(status, city);
CREATE INDEX idx_users_age_status ON users(age, status);
```

### 2. ç¼“å­˜ç­–ç•¥

- **æŸ¥è¯¢ç¼“å­˜**: å¯¹é¢‘ç¹çš„æœç´¢æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
- **ç”¨æˆ·ç¼“å­˜**: å¯¹å•ä¸ªç”¨æˆ·ä¿¡æ¯è¿›è¡Œç¼“å­˜ï¼ˆ10åˆ†é’Ÿï¼‰
- **ç»Ÿè®¡ç¼“å­˜**: å¯¹ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰

### 3. åˆ†é¡µç­–ç•¥é€‰æ‹©

- **åç§»åˆ†é¡µ**: é€‚ç”¨äºæ€»æ•°æ®é‡ < 10ä¸‡ï¼Œç”¨æˆ·éœ€è¦è·³é¡µ
- **æ¸¸æ ‡åˆ†é¡µ**: é€‚ç”¨äºæ€»æ•°æ®é‡ > 10ä¸‡ï¼Œç”¨æˆ·é¡ºåºæµè§ˆ

### 4. æŸ¥è¯¢ä¼˜åŒ–

- ä½¿ç”¨ `Select` åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
- åˆç†ä½¿ç”¨ `Preload` é¿å… N+1 æŸ¥è¯¢
- å¯¹å¤§è¡¨ä½¿ç”¨ç´¢å¼•è¦†ç›–æŸ¥è¯¢

## å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. SQLæ³¨å…¥é˜²æŠ¤

- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- âœ… éªŒè¯æ’åºå­—æ®µç™½åå•
- âœ… æ¸…ç†ç”¨æˆ·è¾“å…¥

### 2. å‚æ•°éªŒè¯

- âœ… é¡µç å’Œé¡µå¤§å°é™åˆ¶
- âœ… æœç´¢è¯é•¿åº¦é™åˆ¶
- âœ… ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

### 3. è®¿é—®æ§åˆ¶

- ğŸ”„ æ·»åŠ è®¤è¯ä¸­é—´ä»¶
- ğŸ”„ å®ç°æƒé™æ£€æŸ¥
- ğŸ”„ è®°å½•å®¡è®¡æ—¥å¿—

## æ‰©å±•åŠŸèƒ½

### 1. æœç´¢é«˜äº®

```go
// åœ¨æœåŠ¡å±‚æ·»åŠ æœç´¢è¯é«˜äº®åŠŸèƒ½
func (s *UserService) HighlightSearchTerms(users []User, searchTerm string) []User {
    // å®ç°æœç´¢è¯é«˜äº®é€»è¾‘
}
```

### 2. æœç´¢å»ºè®®

```go
// æ·»åŠ æœç´¢å»ºè®®åŠŸèƒ½
func (s *UserService) GetSearchSuggestions(partial string) []string {
    // å®ç°æœç´¢å»ºè®®é€»è¾‘
}
```

### 3. å¯¼å‡ºåŠŸèƒ½

```go
// æ·»åŠ æœç´¢ç»“æœå¯¼å‡ºåŠŸèƒ½
func (s *UserService) ExportSearchResults(params *SearchParams) ([]byte, error) {
    // å®ç°CSV/Excelå¯¼å‡º
}
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æŸ¥è¯¢ç¼“æ…¢**
   - æ£€æŸ¥æ˜¯å¦ç¼ºå°‘æ•°æ®åº“ç´¢å¼•
   - ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶
   - å‡å°‘è¿”å›å­—æ®µ

2. **å†…å­˜å ç”¨é«˜**
   - é™åˆ¶åˆ†é¡µå¤§å°
   - ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ
   - æ£€æŸ¥ç¼“å­˜ç­–ç•¥

3. **ç¼“å­˜å¤±æ•ˆ**
   - æ£€æŸ¥Redisè¿æ¥
   - éªŒè¯ç¼“å­˜é”®æ ¼å¼
   - è°ƒæ•´ç¼“å­˜è¿‡æœŸæ—¶é—´

### ç›‘æ§æŒ‡æ ‡

- æŸ¥è¯¢å“åº”æ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡
- æ•°æ®åº“è¿æ¥æ•°
- å†…å­˜ä½¿ç”¨æƒ…å†µ
